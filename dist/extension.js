"use strict";var Se=Object.create;var Q=Object.defineProperty;var Oe=Object.getOwnPropertyDescriptor;var ve=Object.getOwnPropertyNames;var Ne=Object.getPrototypeOf,De=Object.prototype.hasOwnProperty;var P=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),Ee=(e,r)=>{for(var o in r)Q(e,o,{get:r[o],enumerable:!0})},G=(e,r,o,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let u of ve(r))!De.call(e,u)&&u!==o&&Q(e,u,{get:()=>r[u],enumerable:!(a=Oe(r,u))||a.enumerable});return e};var z=(e,r,o)=>(o=e!=null?Se(Ne(e)):{},G(r||!e||!e.__esModule?Q(o,"default",{value:e,enumerable:!0}):o,e)),be=e=>G(Q({},"__esModule",{value:!0}),e);var $=P(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.JSONRepairError=void 0;var V=class extends Error{constructor(r,o){super(r+" at position "+o),this.position=o}};W.JSONRepairError=V});var de=P(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0});s.codeZero=s.codeUppercaseF=s.codeUppercaseE=s.codeUppercaseA=s.codeTab=s.codeSpace=s.codeSlash=s.codeSemicolon=s.codeReturn=s.codeQuote=s.codePlus=s.codeOpeningBracket=s.codeOpeningBrace=s.codeOpenParenthesis=s.codeNine=s.codeNewline=s.codeMinus=s.codeLowercaseF=s.codeLowercaseE=s.codeLowercaseA=s.codeFormFeed=s.codeDoubleQuote=s.codeDot=s.codeComma=s.codeColon=s.codeClosingBracket=s.codeClosingBrace=s.codeCloseParenthesis=s.codeBackspace=s.codeBackslash=s.codeAsterisk=void 0;s.endsWithCommaOrNewline=cr;s.insertBeforeLastWhitespace=sr;s.isControlCharacter=Ye;s.isDelimiter=ne;s.isDelimiterExceptSlash=Ge;s.isDigit=He;s.isDoubleQuote=rr;s.isDoubleQuoteLike=ie;s.isFunctionName=ir;s.isHex=Ke;s.isQuote=ce;s.isSingleQuote=or;s.isSingleQuoteLike=ae;s.isSpecialWhitespace=er;s.isStartOfValue=ze;s.isValidStringCharacter=Ze;s.isWhitespace=_;s.removeAtIndex=nr;s.stripLastOccurrence=tr;var Dr=s.codeBackslash=92,Er=s.codeSlash=47,br=s.codeAsterisk=42,kr=s.codeOpeningBrace=123,Br=s.codeClosingBrace=125,Jr=s.codeOpeningBracket=91,yr=s.codeClosingBracket=93,Lr=s.codeOpenParenthesis=40,Qr=s.codeCloseParenthesis=41,ke=s.codeSpace=32,X=s.codeNewline=10,Y=s.codeTab=9,ee=s.codeReturn=13,Be=s.codeBackspace=8,Je=s.codeFormFeed=12,re=s.codeDoubleQuote=34,Pr=s.codePlus=43,Wr=s.codeMinus=45,oe=s.codeQuote=39,te=s.codeZero=48,se=s.codeNine=57,Rr=s.codeComma=44,Fr=s.codeDot=46,Tr=s.codeColon=58,Mr=s.codeSemicolon=59,ye=s.codeUppercaseA=65,Le=s.codeLowercaseA=97,jr=s.codeUppercaseE=69,Ur=s.codeLowercaseE=101,Qe=s.codeUppercaseF=70,Pe=s.codeLowercaseF=102,We=160,Re=8192,Fe=8202,Te=8239,Me=8287,je=12288,Ue=8220,Ve=8221,$e=8216,_e=8217,Ie=96,qe=180;function Ke(e){return e>=te&&e<=se||e>=ye&&e<=Qe||e>=Le&&e<=Pe}function He(e){return e>=te&&e<=se}function Ze(e){return e>=32&&e<=1114111}function ne(e){return xe.test(e)}var xe=/^[,:[\]/{}()\n+]$/;function Ge(e){return ne(e)&&e!=="/"}function ze(e){return Xe.test(e)||e&&ce(e.charCodeAt(0))}var Xe=/^[[{\w-]$/;function Ye(e){return e===X||e===ee||e===Y||e===Be||e===Je}function _(e){return e===ke||e===X||e===Y||e===ee}function er(e){return e===We||e>=Re&&e<=Fe||e===Te||e===Me||e===je}function ce(e){return ie(e)||ae(e)}function ie(e){return e===re||e===Ue||e===Ve}function rr(e){return e===re}function ae(e){return e===oe||e===$e||e===_e||e===Ie||e===qe}function or(e){return e===oe}function tr(e,r){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=e.lastIndexOf(r);return a!==-1?e.substring(0,a)+(o?"":e.substring(a+1)):e}function sr(e,r){let o=e.length;if(!_(e.charCodeAt(o-1)))return e+r;for(;_(e.charCodeAt(o-1));)o--;return e.substring(0,o)+r+e.substring(o)}function nr(e,r,o){return e.substring(0,r)+e.substring(r+o)}function cr(e){return/[,\n][ \t\r]*$/.test(e)}function ir(e){return/^\w+$/.test(e)}});var ue=P(I=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0});I.jsonrepair=ur;var E=$(),t=de(),ar={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},dr={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function ur(e){let r=0,o="";f()||Ce();let u=h(t.codeComma);for(u&&d(),(0,t.isStartOfValue)(e[r])&&(0,t.endsWithCommaOrNewline)(o)?(u||(o=(0,t.insertBeforeLastWhitespace)(o,",")),j()):u&&(o=(0,t.stripLastOccurrence)(o,","));e.charCodeAt(r)===t.codeClosingBrace||e.charCodeAt(r)===t.codeClosingBracket;)r++,d();if(r>=e.length)return o;me();function f(){d();let n=v()||M()||A()||pe()||he()||H();return d(),n}function d(){let n=r,i=p();do i=C(),i&&(i=p());while(i);return r>n}function p(){let n="",i;for(;(i=(0,t.isWhitespace)(e.charCodeAt(r)))||(0,t.isSpecialWhitespace)(e.charCodeAt(r));)i?n+=e[r]:n+=" ",r++;return n.length>0?(o+=n,!0):!1}function C(){if(e.charCodeAt(r)===t.codeSlash&&e.charCodeAt(r+1)===t.codeAsterisk){for(;r<e.length&&!lr(e,r);)r++;return r+=2,!0}if(e.charCodeAt(r)===t.codeSlash&&e.charCodeAt(r+1)===t.codeSlash){for(;r<e.length&&e.charCodeAt(r)!==t.codeNewline;)r++;return!0}return!1}function h(n){return e.charCodeAt(r)===n?(o+=e[r],r++,!0):!1}function m(n){return e.charCodeAt(r)===n?(r++,!0):!1}function J(){return m(t.codeBackslash)}function T(){return d(),e.charCodeAt(r)===t.codeDot&&e.charCodeAt(r+1)===t.codeDot&&e.charCodeAt(r+2)===t.codeDot?(r+=3,d(),m(t.codeComma),!0):!1}function v(){if(e.charCodeAt(r)===t.codeOpeningBrace){o+="{",r++,d(),m(t.codeComma)&&d();let n=!0;for(;r<e.length&&e.charCodeAt(r)!==t.codeClosingBrace;){let i;if(n?(i=!0,n=!1):(i=h(t.codeComma),i||(o=(0,t.insertBeforeLastWhitespace)(o,",")),d()),T(),!(A()||H())){e.charCodeAt(r)===t.codeClosingBrace||e.charCodeAt(r)===t.codeOpeningBrace||e.charCodeAt(r)===t.codeClosingBracket||e.charCodeAt(r)===t.codeOpeningBracket||e[r]===void 0?o=(0,t.stripLastOccurrence)(o,","):we();break}d();let b=h(t.codeColon),D=r>=e.length;b||((0,t.isStartOfValue)(e[r])||D?o=(0,t.insertBeforeLastWhitespace)(o,":"):x()),f()||(b||D?o+="null":x())}return e.charCodeAt(r)===t.codeClosingBrace?(o+="}",r++):o=(0,t.insertBeforeLastWhitespace)(o,"}"),!0}return!1}function M(){if(e.charCodeAt(r)===t.codeOpeningBracket){o+="[",r++,d(),m(t.codeComma)&&d();let n=!0;for(;r<e.length&&e.charCodeAt(r)!==t.codeClosingBracket;)if(n?n=!1:h(t.codeComma)||(o=(0,t.insertBeforeLastWhitespace)(o,",")),T(),!f()){o=(0,t.stripLastOccurrence)(o,",");break}return e.charCodeAt(r)===t.codeClosingBracket?(o+="]",r++):o=(0,t.insertBeforeLastWhitespace)(o,"]"),!0}return!1}function j(){let n=!0,i=!0;for(;i;)n?n=!1:h(t.codeComma)||(o=(0,t.insertBeforeLastWhitespace)(o,",")),i=f();i||(o=(0,t.stripLastOccurrence)(o,",")),o=`[
`.concat(o,`
]`)}function A(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,i=e.charCodeAt(r)===t.codeBackslash;if(i&&(r++,i=!0),(0,t.isQuote)(e.charCodeAt(r))){let S=(0,t.isDoubleQuote)(e.charCodeAt(r))?t.isDoubleQuote:(0,t.isSingleQuote)(e.charCodeAt(r))?t.isSingleQuote:(0,t.isSingleQuoteLike)(e.charCodeAt(r))?t.isSingleQuoteLike:t.isDoubleQuoteLike,b=r,D=o.length,l='"';for(r++;;){if(r>=e.length){let g=Z(r-1);return!n&&(0,t.isDelimiter)(e.charAt(g))?(r=b,o=o.substring(0,D),A(!0)):(l=(0,t.insertBeforeLastWhitespace)(l,'"'),o+=l,!0)}else if(S(e.charCodeAt(r))){let g=r,O=l.length;if(l+='"',r++,o+=l,d(),n||r>=e.length||(0,t.isDelimiter)(e.charAt(r))||(0,t.isQuote)(e.charCodeAt(r))||(0,t.isDigit)(e.charCodeAt(r)))return y(),!0;if((0,t.isDelimiter)(e.charAt(Z(g-1))))return r=b,o=o.substring(0,D),A(!0);o=o.substring(0,D),r=g+1,l=l.substring(0,O)+"\\"+l.substring(O)}else{if(n&&(0,t.isDelimiter)(e[r]))return l=(0,t.insertBeforeLastWhitespace)(l,'"'),o+=l,y(),!0;if(e.charCodeAt(r)===t.codeBackslash){let g=e.charAt(r+1);if(dr[g]!==void 0)l+=e.slice(r,r+2),r+=2;else if(g==="u"){let k=2;for(;k<6&&(0,t.isHex)(e.charCodeAt(r+k));)k++;k===6?(l+=e.slice(r,r+6),r+=6):r+k>=e.length?r=e.length:Ae()}else l+=g,r+=2}else{let g=e.charAt(r),O=e.charCodeAt(r);O===t.codeDoubleQuote&&e.charCodeAt(r-1)!==t.codeBackslash?(l+="\\"+g,r++):(0,t.isControlCharacter)(O)?(l+=ar[g],r++):((0,t.isValidStringCharacter)(O)||ge(g),l+=g,r++)}}i&&J()}}return!1}function y(){let n=!1;for(d();e.charCodeAt(r)===t.codePlus;){n=!0,r++,d(),o=(0,t.stripLastOccurrence)(o,'"',!0);let i=o.length;A()?o=(0,t.removeAtIndex)(o,i,1):o=(0,t.insertBeforeLastWhitespace)(o,'"')}return n}function pe(){let n=r;if(e.charCodeAt(r)===t.codeMinus){if(r++,L())return U(n),!0;if(!(0,t.isDigit)(e.charCodeAt(r)))return r=n,!1}for(;(0,t.isDigit)(e.charCodeAt(r));)r++;if(e.charCodeAt(r)===t.codeDot){if(r++,L())return U(n),!0;if(!(0,t.isDigit)(e.charCodeAt(r)))return r=n,!1;for(;(0,t.isDigit)(e.charCodeAt(r));)r++}if(e.charCodeAt(r)===t.codeLowercaseE||e.charCodeAt(r)===t.codeUppercaseE){if(r++,(e.charCodeAt(r)===t.codeMinus||e.charCodeAt(r)===t.codePlus)&&r++,L())return U(n),!0;if(!(0,t.isDigit)(e.charCodeAt(r)))return r=n,!1;for(;(0,t.isDigit)(e.charCodeAt(r));)r++}if(!L())return r=n,!1;if(r>n){let i=e.slice(n,r),S=/^0\d/.test(i);return o+=S?'"'.concat(i,'"'):i,!0}return!1}function he(){return N("true","true")||N("false","false")||N("null","null")||N("True","true")||N("False","false")||N("None","null")}function N(n,i){return e.slice(r,r+n.length)===n?(o+=i,r+=n.length,!0):!1}function H(){let n=r;for(;r<e.length&&!(0,t.isDelimiterExceptSlash)(e[r])&&!(0,t.isQuote)(e.charCodeAt(r));)r++;if(r>n){if(e.charCodeAt(r)===t.codeOpenParenthesis&&(0,t.isFunctionName)(e.slice(n,r).trim()))return r++,f(),e.charCodeAt(r)===t.codeCloseParenthesis&&(r++,e.charCodeAt(r)===t.codeSemicolon&&r++),!0;{for(;(0,t.isWhitespace)(e.charCodeAt(r-1))&&r>0;)r--;let i=e.slice(n,r);return o+=i==="undefined"?"null":JSON.stringify(i),e.charCodeAt(r)===t.codeDoubleQuote&&r++,!0}}}function Z(n){let i=n;for(;i>0&&(0,t.isWhitespace)(e.charCodeAt(i));)i--;return i}function L(){return r>=e.length||(0,t.isDelimiter)(e[r])||(0,t.isWhitespace)(e.charCodeAt(r))}function U(n){o+=e.slice(n,r)+"0"}function ge(n){throw new E.JSONRepairError("Invalid character "+JSON.stringify(n),r)}function me(){throw new E.JSONRepairError("Unexpected character "+JSON.stringify(e[r]),r)}function Ce(){throw new E.JSONRepairError("Unexpected end of json string",e.length)}function we(){throw new E.JSONRepairError("Object key expected",r)}function x(){throw new E.JSONRepairError("Colon expected",r)}function Ae(){let n=e.slice(r,r+6);throw new E.JSONRepairError('Invalid unicode character "'.concat(n,'"'),r)}}function lr(e,r){return e[r]==="*"&&e[r+1]==="/"}});var le=P(R=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0});Object.defineProperty(R,"JSONRepairError",{enumerable:!0,get:function(){return pr.JSONRepairError}});Object.defineProperty(R,"jsonrepair",{enumerable:!0,get:function(){return fr.jsonrepair}});var fr=ue(),pr=$()});var Or={};Ee(Or,{activate:()=>Ar,deactivate:()=>Sr});module.exports=be(Or);var B=z(require("path")),c=z(require("vscode")),{jsonrepair:K}=le(),hr="idd-json-tools",w=e=>`${hr}.${e}`,fe=e=>e.replace(/<<<<<<<.+/g,"").replace(/>>>>>>>.+/g,"").replace(/=======.*/g,""),q=e=>Array.isArray(e)?e.map(q):e!==null&&typeof e=="object"?Object.keys(e).sort((r,o)=>typeof e[r]=="object"&&typeof e[o]!="object"?1:typeof e[r]!="object"&&typeof e[o]=="object"||o>r?-1:1).reduce((r,o)=>(r[o]=q(e[o]),r),{}):e,gr=async()=>{let e=c.window.activeTextEditor;if(e)try{await e.edit(r=>{let o=e.document,a=o.getText(),u=K(fe(a)),f=JSON.parse(u),d=JSON.stringify(f,void 0,2),p=new c.Range(o.positionAt(0),o.positionAt(o.getText().length));r.replace(p,d)})}catch(r){c.window.showErrorMessage(`JSON Repair Error: ${r.message}`)}},mr=async()=>{let e=c.window.activeTextEditor?.document;if(!e)return;let r=c.workspace.getWorkspaceFolder(e.uri),o=c.window.createQuickPick();o.placeholder="\u8F93\u5165\u76EE\u6807\u6587\u4EF6\u5939\u8DEF\u5F84",o.title="\u5408\u5E76\u6240\u6709\u542B\u6709\u4EE3\u7801\u51B2\u7A81\u7684JSON\u6587\u4EF6",o.onDidChangeValue(async a=>{if(a){let u=await c.workspace.findFiles(`**/${a}*/**`,"**/node_modules/**",10),f=new Set;for(let p of u){let C=B.default.relative(r.uri.fsPath,B.default.dirname(p.fsPath));if(!C)continue;let h="";for(let m of C.split("/"))h=h?`${h}/${m}`:m,f.add(h)}let d=Array.from(f);d.sort((p,C)=>p.length-C.length),f.clear(),o.items=d.map(p=>({label:p}))}else o.items=[]}),o.onDidAccept(()=>{let a=o.selectedItems[0];if(a)try{let u=B.default.join(r.uri.fsPath,a.label),f=async d=>{let p=c.Uri.parse(d),C=await c.workspace.fs.readDirectory(p);await Promise.all(C.map(async([h,m])=>{if(m===1){if(B.default.extname(h).toLowerCase()!==".json")return;let J=c.Uri.joinPath(p,h),v=(await c.workspace.fs.readFile(J)).toString();if(!(/<<<<<<</.test(v)&&/=======/.test(v)&&/>>>>>>>/.test(v)))return;let M=K(fe(v)),j=JSON.parse(M),A=JSON.stringify(j,void 0,2),y=Buffer.from(A,"utf-8");c.workspace.fs.writeFile(J,y)}m===2&&await f(c.Uri.joinPath(p,h).fsPath)}))};f(u)}catch(u){c.window.showErrorMessage(`JSON Merge Error: ${u.message}`)}o.hide()}),o.onDidHide(()=>o.dispose()),o.show()},Cr=async()=>{let e=c.window.activeTextEditor;if(e)try{await e.edit(r=>{let o=e.document,a=o.getText(),u=K(a),f=JSON.parse(u),d=JSON.stringify(f,void 0,2),p=new c.Range(o.positionAt(0),o.positionAt(o.getText().length));r.replace(p,d)})}catch(r){c.window.showErrorMessage(`JSON Repair Error: ${r.message}`)}},wr=async()=>{let e=c.window.activeTextEditor;if(e)try{await e.edit(r=>{let o=e.document,a=o.getText(),u=JSON.parse(a),f=JSON.stringify(q(u),void 0,2),d=new c.Range(o.positionAt(0),o.positionAt(o.getText().length));r.replace(d,f)})}catch(r){c.window.showErrorMessage(`JSON Repair Error: ${r.message}`)}},F=e=>{let r=e?.document;if(!r||r.languageId!=="json")return;let o=r.getText();try{JSON.parse(o),c.commands.executeCommand("setContext",w("isValidJSONFile"),!0),c.commands.executeCommand("setContext",w("isNeedMergeJSONFile"),!1)}catch{c.commands.executeCommand("setContext",w("isValidJSONFile"),!1),c.commands.executeCommand("setContext",w("isNeedMergeJSONFile"),/<<<<<<</.test(o)&&/=======/.test(o)&&/>>>>>>>/.test(o))}};function Ar(e){let r=[c.commands.registerCommand(w("tryMergeJson"),gr),c.commands.registerCommand(w("tryMergeAllJSON"),mr),c.commands.registerCommand(w("tryRepairJson"),Cr),c.commands.registerCommand(w("sortJSONKey"),wr)];e.subscriptions.push(...r),c.window.onDidChangeActiveTextEditor(F,null,e.subscriptions),c.workspace.onDidChangeTextDocument(o=>{let a=c.window.activeTextEditor;a&&o.document===a.document&&F(a)},null,e.subscriptions),c.workspace.onDidOpenTextDocument(o=>{let a=c.window.activeTextEditor;a&&o===a.document&&F(a)},null,e.subscriptions),c.window.activeTextEditor&&F(c.window.activeTextEditor)}function Sr(){}0&&(module.exports={activate,deactivate});
